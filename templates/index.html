<!DOCTYPE html>
<html class="has-navbar-fixed-top" lang="fr">

<head>
  <!-- language utf8 pour indiquer l'encodage -->
  <meta charset="UTF-8">
  <!-- pour l'adapter plus ou moins bien sur telephone -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- titre en haut dans le navigateur -->
  <title>Mon lycée</title>
  <!-- page de style -->
  <link rel="stylesheet" type="text/css" href="{{url_for('static',filename='styles/style.css')}}">
  <!-- importation de la bibliotheque j query qui est requise pour faire marcher le js-->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <!-- <link rel="stylesheet" href="{{url_for('static',filename='css/mystyles.css')}}"> -->
  <link rel="stylesheet" href="{{url_for('static',filename='css/mystyles.css')}}">
  <script src="https://kit.fontawesome.com/87544e3da3.js" crossorigin="anonymous"></script>
  <!-- importation du JS pour afficher et enlever les div -->
  <script src="{{url_for('static',filename='js/publication.js')}}" type="text/javascript"></script><script src="{{url_for('static',filename='js/main.js')}}" type="text/javascript"></script>
  {%if user['admin']==true%}<script src="{{url_for('static',filename='js/administration.js')}}" type="text/javascript"></script>{%endif%}
  <script type="text/javascript" src="/static/js/filtres.js"></script>
  <script type="text/javascript" src="/static/js/bandeau.js"></script>
  <style>
    .logoBouton:hover {
      cursor: pointer;
    }
  </style>
</head>

<body>
  {% include 'bandeau.html' %}
  <div class="modal" id="signalisation" style="overflow:hidden;">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <p class="modal-card-title">Signalement</p>
      </header>
      <form onsubmit="signaler(event); return false;" id="signalement" method="POST" autocomplete="off">
        <section class="modal-card-body">
          <input id='inputRaison' class="input" type="text" placeholder="Pourquoi Signalez vous ce message." autocomplete='off' name="Raison" style="width: 75%;margin-left: 2%;padding:5px;"required/>
          <input type='hidden' id="idSignalé" name='idSignalé' value="" />
        </section>
        <footer class="modal-card-foot">
          <button type="submit" class="button is-success">Signaler</button>
          <button onclick="signalisationClose(); return false;" class="button">Annuler</button>
        </footer>
      </form>
    </div>
  </div>
  <div class="modal" id="designalisation" style="overflow:hidden;">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <p class="modal-card-title">Retrait de signalement</p>
      </header>
      <form onsubmit="designaler(event); return false;" id="designalement" method="POST" autocomplete="off">
        <section class="modal-card-body">
          <input type='hidden' id="idDesignalé" name='idSignalé' value="" />
          Etes-vous sûr de vouloir enlever ce signalement
        </section>
        <footer class="modal-card-foot">
          <button type="submit" class="button is-success">Oui</button>
          <button onclick="designalisationClose(); return false;" class="button">Annuler</button>
        </footer>
      </form>
    </div>
  </div>
  {%if user['admin']==true%}
  <div class="modal" id="suppression" style="overflow:hidden;">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <p class="modal-card-title">Supression</p>
      </header>
      <form onsubmit="supprimer(event); return false;" id="supprForm" method="POST" autocomplete="off">
        <section class="modal-card-body">
          <input type="text" name="motif" placeholder="motif"required/>
          <input type='hidden' id="idSupprimé" name='idSuppr' value="" />
          <input type='hidden' name="demandeBut" value="Suppr" />
        </section>
        <footer class="modal-card-foot">
          <button type="submit" class="button is-success">supprimer</button>
          <button onclick="supprimerClose(); return false;" class="button">Annuler</button>
        </footer>
      </form>
    </div>
  </div>
  {%endif%}

  <!-- Div pour les filtres -->
  {% include 'filtres.html' with context %}

  <!-- debut de la div pour tt les publications -->
  <div id="contentPost" class="columns" style="margin-top: 10px; width:100%;">
    <div class="column"></div>
    <div class="column is-three-fifths">
      {%for d in demandes %}
        <!-- Début publi -->
        <div id="divDemande_{{d['idMsg']}}" class="box demande" style="border-radius: 20px; margin-bottom: 0.8rem;" data-subject="{{d['tag-matière']}}">
          <article class="media">
            <div class="media-left">
              <!-- Image photo de profil-->
              <figure class="image is-64x64">
                <img alt="user"  src="{%if 'nomImg' in d['user'] and d['user']['nomImg'] != "" %}{{url_for('userImg', profilImg = d['user']['nomImg'])}}{%else%}{{url_for('static',filename='image/sans_profil.png')}}{%endif%}" style="width:80px; height:auto;" />
              </figure>
            </div>
            <!-- Contenu publication -->
            <div class="media-content">
              <div class="content">
                <p style="margin-bottom: 5px;">
                  <!-- Nom utilisateur ; pseudo ; temps -->
                  <div style="font-variant: small-caps;">
                    <a href="{{url_for('profil' ,idUser=d['user']['_id'])}}">{{d['user']['nom']}} {{d['user']['prenom']}}</a>
                    <span style="display: inline-block; margin-right: 40px;"></span>{{d['matière']}}
                  </div>
                  <small><em>@{{d['user']['pseudo']}}</em></small> <small>{{d['temps']}}</small>
                </p>
                <!-- Titre -->
                <h4 style="margin-top: 0;">{{d['titre']}}</h4>
                <!-- Texte publication -->
                <p style="word-wrap:break-word;">{{d['contenu']}}</p>
                </p>
              </div>
              <!-- Icons like et commentaire -->
              <nav class="level is-mobile">
                <div class="level-left">
                  <a class="level-item" aria-label="like" onClick="like('{{d['idMsg']}}')">
                    <span class="icon">
                      {% if d['a_like'] %}
                        <i id="like_{{d['idMsg']}}" class="fas fa-thumbs-up" aria-hidden="true" style="padding-left: 5px;color:{{session['couleur'][2]}};font-size: 20px;">{{d['nb-likes']}}</i>
                      {% else %}
                        <i id="like_{{d['idMsg']}}" class="far fa-thumbs-up" aria-hidden="true" style="padding-left: 5px;color:{{session['couleur'][2]}};font-size: 20px;">{{d['nb-likes']}}</i>
                      {% endif %}
                    </span>
                  </a>
                  <a class="level-item" style="margin-left:2%;" aria-label="comment" href="/comments/{{d['idMsg']}}">
                    <span class="icon is-small">
                      <i class="far fa-comment" style="color:{{session['couleur'][2]}};font-size: 20px;" aria-hidden="true"></i>
                    </span>
                  </a>
                  <!-- <a class="level-item" aria-label="sign" onClick="sign('{{d['idMsg']}}')">
                    <span class="icon is-small">
                      {% if d['a_sign'] %}
                        <i id="sign_{{d['idMsg']}}" class="fas fa-flag" aria-hidden="true" style="padding-left: 5px;"></i>
                      {% else %}
                        <i id="sign_{{d['idMsg']}}" class="far fa-flag" aria-hidden="true" style="padding-left: 5px;"></i>
                      {% endif %}
                    </span>
                  </a> -->
                </div>
              </nav>
            </div>
            <!-- Signaler -->
            <div style="display: flex; flex-direction: column;">
                  <div class="navbar-item">
                    <button  class="button is-warning is-outlined is-small" onClick="sign('{{d['idMsg']}}')">
                      <span class="icon is-small">
                        {% if d['a_sign'] %}
                        <i id="sign_{{d['idMsg']}}" class="fas fa-flag" aria-hidden="true"></i>
                        {% else %}
                          <i id="sign_{{d['idMsg']}}" class="far fa-flag" aria-hidden="true"></i>
                        {% endif %}
                      </span>
                      <span>Signaler</span>
                    </button>
                    <input type="hidden" />
                  </div>
                  <!-- Résolu -->
                  {% if d['idAuteur'] == user['_id'] %}
                  <div class="navbar-item">
                    <button  class="button is-success is-outlined is-small" onClick="resoudre('{{d['idMsg']}}')">
                      <span class="icon is-small">
                        {% if d['resolu'] %}
                        <i class="fas fa-check-square" aria-hidden="true"></i>
                        {% else %}
                        <i class="far fa-check-square" aria-hidden="true"></i>
                        {% endif %}
                      </span>
                      <span>Résolu &nbsp;</span>
                    </button>
                    <input type="hidden" />
                  </div>
                  {% endif %}
                  {%if user['admin']==true%}
                  <div class="navbar-item">
                    <button class="button is-danger is-outlined is-small" onClick="suppression('{{d['idMsg']}}')">
                      <span class="icon is-small">
                        <i class="fas fa-times"></i>
                      </span>
                      <span>Supprimer &nbsp;</span>
                    </button>
                    <input type="hidden" />
                  </div>
                  {%endif%}
                </div>
          </article>
        </div>
        <!-- Fin publi -->
      {%endfor%}
    </div>
    <div class="column"></div>
  </div>

  <!-- fin de l'espace des publication -->

</body>

</html>
